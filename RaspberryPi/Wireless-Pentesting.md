# Wireless Pentesting with a Raspberry Pi 4 and Kali Linux
## Requirements
- **Required:**
  - Raspberry Pi 4 (2GB, 4GB or 8GB)
  - Micro SD card (Minimal 16GB, preferably 32GB+)
  - [Raspberry Pi Imager software](https://www.raspberrypi.com/software/) (You can also download Kali Linux for Raspberry Pi manually and install it to a micro SD card, but I prefer to use the imager software provided by Raspberry Pi, as it already includes the latest Kali Linux images.)
  - Ethernet cable with internet connection (We will use the built-in WiFi for setting up an access point, so we need another network interface to connect to the internet and install packages.)
- **Optional:**
  - Monitor with micro HDMI connection (Only needed for local setup)
  - USB keyboard and mouse (Only needed for local setup)
  - USB WiFi adapter (Preferably one that is supported with Linux in-kernel drivers, please visit this amazing [GitHub repo from morrownr](https://github.com/morrownr/USB-WiFi/blob/main/home/USB_WiFi_Adapters_that_are_supported_with_Linux_in-kernel_drivers.md) for more in-depth knowledge on USB WiFi adapters and their chipsets.) I like to use my ALFA AWUS036ACM.

## Initial setup
Use the Raspberry Pi Imager tool to flash Kali Linux (preferably 32-bit, as it gets more testing) to the micro SD card.
Insert the SD card into the Raspberry Pi, as any other software installation on the Pi, and connect it to a power source and let it boot for 1-2 minutes.

> Be aware that the default Kali Linux image for Raspberry Pi has SSH enabled and uses the default kali:kali credentials.

Now you have two options: Use SSH to connect to the freshly installed Pi, or connect both a monitor and keyboard and mouse to it and do the configuration locally.
I prefer to use SSH to do the configuration, as everything can be done through a command line.

Let's start by updating the system with the newest packages:
```
$ sudo apt update
$ sudo apt full-upgrade -y
```

I recommend to install these Kali Linux Metapackages ([list of metapackages](https://www.kali.org/docs/general-use/metapackages/)):
> Most of them are already installed by default, but I like to ensure that this is the case be explicitly invoking an installation.
```
$ sudo apt install -y kali-linux-core kali-linux-default kali-linux-arm kali-linux-headless
```
I do not recommend to install any other Metapackages as long as you don't need them, just to save some space on our (maybe limited in space) micro SD card.

To make bluetooth work properly, you need to enable and start two services:
```
$ sudo systemctl enable --now hciuart.service
$ sudo systemctl enable --now bluetooth.service
```

## Access point setup
We start by installing the necessary packages:
```
$ sudo apt install -y hostapd dnsmasq
```

Now let's configure our wireless network interface with a static ip address. This will be the ip address of our access point we will create.
We need to edit /etc/network/interfaces and add some lines to configure our wireless network interface, wlan0 in my case.
> Feel free to use a text editor of your choice :)
```
$ sudo nano /etc/network/interfaces
```
My configuration file looks like this:
```
source-directory /etc/network/interfaces.d

auto lo
  iface lo inet static

allow-hotplug wlan0
iface wlan0 inet static
  address 192.168.0.1
  netmask 255.255.255.0
  network 192.168.0.1
  broadcast 192.168.0.255
```

There's no need to restart any services at this point. We first configure hostapd and dnsmasq too and restart our system when everything is set up to verify the working our configuration.

Let's start configuring dnsmasq to function as DHCP server on our wireless network interface. Clients will later connect to it and have to receive a valid ip configuration.
We first move the original configuration out of the way and create one for ourselves.
```
$ sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig
$ sudo nano /etc/dnsmasq.conf
```
My configuration file looks like this:
> As I already mentioned, we just need a DHCP server for our setup to function properly. These two lines is all we need to achieve this. Easy, isn't it? :)
```
interface=wlan0
dhcp-range=192.168.0.2,192.168.0.5,24h
```
> I choose to only include a small range (192.168.0.2 to 192.168.0.5) of ip addresses in my DHCP range with a lease period of 24 hours. Of course you can use whatever you prefer. The same goes for the configuration of the wireless network interface itself. 
